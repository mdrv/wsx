---
import { css } from '../../styled-system/css'
import Footer from '../components/Footer.astro'
import Header from '../components/Header.astro'
import Navigation from '../components/Navigation.astro'
import '../index.css'

interface Props {
	title: string
	description?: string
}

const { title, description } = Astro.props
const fullTitle = title === '@mdrv/wsx' ? title : `${title} - @mdrv/wsx`
---

<!DOCTYPE html>
<html lang='en'>
	<head>
		<meta charset='UTF-8'>
		<meta name='viewport' content='width=device-width, initial-scale=1.0'>
		<title>{fullTitle}</title>
		{description && <meta name='description' content={description} />}
		<link rel='icon' type='image/svg+xml' href='/wsx/favicon.svg' />

		<!-- Pagefind CSS -->
		<link href='/wsx/pagefind/pagefind-ui.css' rel='stylesheet'>

		<script is:inline>
		// Apply theme before page renders to prevent flash
		;(function() {
			const theme = localStorage.getItem('theme') || 'light'
			if (theme === 'dark') {
				document.documentElement.classList.add('dark')
			}
		})()
		</script>

		<script is:inline>
		// Mobile menu toggle
		document.addEventListener('DOMContentLoaded', () => {
			const menuButton = document.getElementById('mobile-menu-button')
			const mobileMenu = document.getElementById('mobile-menu')
			const overlay = document.getElementById('menu-overlay')

			function toggleMenu() {
				const isOpen = mobileMenu.classList.contains('open')
				if (isOpen) {
					mobileMenu.classList.remove('open')
					overlay.classList.remove('open')
					document.body.style.overflow = ''
				} else {
					mobileMenu.classList.add('open')
					overlay.classList.add('open')
					document.body.style.overflow = 'hidden'
				}
			}

			menuButton?.addEventListener('click', toggleMenu)
			overlay?.addEventListener('click', toggleMenu)

			// Close mobile menu when clicking navigation links
			const navLinks = mobileMenu?.querySelectorAll('a')
			navLinks?.forEach(link => {
				link.addEventListener('click', () => {
					if (mobileMenu.classList.contains('open')) {
						toggleMenu()
					}
				})
			})
		})
		</script>

		<style is:global>
		/* Dark mode variables */
		:root {
			--bg-primary: white;
			--bg-secondary: #f9fafb;
			--bg-tertiary: #f3f4f6;
			--text-primary: #111827;
			--text-secondary: #4b5563;
			--text-tertiary: #6b7280;
			--border-color: #e5e7eb;
			--code-bg: #f3f4f6;
			--overlay-bg: rgba(0, 0, 0, 0.5);
		}

		.dark {
			--bg-primary: #1f2937;
			--bg-secondary: #111827;
			--bg-tertiary: #374151;
			--text-primary: #f9fafb;
			--text-secondary: #d1d5db;
			--text-tertiary: #9ca3af;
			--border-color: #374151;
			--code-bg: #374151;
			--overlay-bg: rgba(0, 0, 0, 0.75);
		}

		#site-header {
			background-color: var(--bg-primary) !important;
			border-color: var(--border-color) !important;
		}

		#mobile-menu {
			position: fixed;
			top: 4rem;
			left: -100%;
			width: 16rem;
			height: calc(100vh - 4rem);
			background: var(--bg-primary);
			border-right: 1px solid var(--border-color);
			overflow-y: auto;
			transition: left 0.3s ease;
			z-index: 40;
		}
		#mobile-menu.open {
			left: 0;
		}
		#menu-overlay {
			position: fixed;
			top: 4rem;
			left: 0;
			width: 100%;
			height: calc(100vh - 4rem);
			background: var(--overlay-bg);
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.3s ease;
			z-index: 30;
		}
		#menu-overlay.open {
			opacity: 1;
			pointer-events: auto;
		}

		/* Pagefind dark mode */
		.dark .pagefind-ui__search-input {
			background-color: var(--bg-tertiary);
			color: var(--text-primary);
			border-color: var(--border-color);
		}
		.dark .pagefind-ui__result {
			background-color: var(--bg-secondary);
			border-color: var(--border-color);
		}
		.dark .pagefind-ui__result-title {
			color: var(--text-primary);
		}
		.dark .pagefind-ui__result-excerpt {
			color: var(--text-secondary);
		}
		</style>
	</head>
	<body
		class={css({
			margin: 0,
			display: 'flex',
			flexDirection: 'column',
			minHeight: '100vh',
			backgroundColor: 'var(--bg-primary)',
			color: 'var(--text-primary)',
			transition: 'background-color 0.3s, color 0.3s',
		})}
	>
		<Header />

		<!-- Mobile menu overlay -->
		<div id='menu-overlay'></div>

		<!-- Mobile menu -->
		<aside id='mobile-menu'>
			<Navigation />
		</aside>

		<div
			class={css({
				display: 'flex',
				flex: 1,
				overflow: 'hidden',
				marginTop: '4rem',
			})}
		>
			<!-- Desktop Sidebar -->
			<aside
				class={css({
					display: { base: 'none', md: 'block' },
					width: '16rem',
					borderRight: '1px solid var(--border-color)',
					backgroundColor: 'var(--bg-primary)',
					overflowY: 'auto',
				})}
			>
				<Navigation />
			</aside>

			<!-- Main Content -->
			<main
				class={css({
					flex: 1,
					overflowY: 'auto',
					padding: { base: '1rem', sm: '1.5rem', md: '2rem 3rem' },
					maxWidth: '56rem',
				})}
			>
				<!-- Search UI -->
				<div id='search' class={css({ marginBottom: '2rem' })}></div>

				<article
					class={css({
						'& h1': {
							fontSize: '3xl',
							fontWeight: 'bold',
							marginBottom: '1rem',
							color: 'var(--text-primary)',
						},
						'& h2': {
							fontSize: '2xl',
							fontWeight: 'bold',
							marginTop: '2rem',
							marginBottom: '1rem',
							color: 'var(--text-primary)',
						},
						'& h3': {
							fontSize: 'xl',
							fontWeight: 'semibold',
							marginTop: '1.5rem',
							marginBottom: '0.75rem',
							color: 'var(--text-primary)',
						},
						'& p': {
							marginBottom: '1rem',
							lineHeight: '1.7',
							color: 'var(--text-secondary)',
						},
						'& ul, & ol': {
							marginBottom: '1rem',
							paddingLeft: '1.5rem',
						},
						'& li': {
							marginBottom: '0.5rem',
							color: 'var(--text-secondary)',
						},
						'& code': {
							fontFamily: 'mono',
							fontSize: '0.9em',
							backgroundColor: 'var(--code-bg)',
							padding: '0.125rem 0.25rem',
							borderRadius: '0.25rem',
							color: 'var(--text-primary)',
						},
						'& pre': {
							marginBottom: '1.5rem',
							borderRadius: 'md',
							overflow: 'auto',
							backgroundColor: 'var(--code-bg)',
						},
						'& pre code': {
							backgroundColor: 'transparent',
							padding: 0,
						},
						'& table': {
							width: '100%',
							borderCollapse: 'collapse',
							marginBottom: '1.5rem',
						},
						'& th, & td': {
							padding: '0.75rem',
							borderBottom: '1px solid var(--border-color)',
							textAlign: 'left',
						},
						'& th': {
							fontWeight: 'semibold',
							backgroundColor: 'var(--bg-secondary)',
							color: 'var(--text-primary)',
						},
						'& td': {
							color: 'var(--text-secondary)',
						},
						'& blockquote': {
							borderLeft: '4px solid',
							borderColor: 'brand.500',
							paddingLeft: '1rem',
							marginLeft: 0,
							marginBottom: '1rem',
							color: 'var(--text-tertiary)',
							fontStyle: 'italic',
						},
						'& a': {
							color: 'brand.600',
							_hover: {
								color: 'brand.700',
							},
						},
					})}
				>
					<slot />
				</article>
			</main>
		</div>

		<Footer />

		<!-- Pagefind Script -->
		<script is:inline>
		document.addEventListener('DOMContentLoaded', () => {
			new window.PagefindUI({
				element: '#search',
				showSubResults: true,
				showImages: false,
				excerptLength: 15,
			})
		})
		</script>
		<script src='/wsx/pagefind/pagefind-ui.js' is:inline></script>
	</body>
</html>
